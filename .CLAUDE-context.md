# CLAUDE Context Snapshot

Дата: 2025-01-09 12:00

## Текущая задача

Реализация MVP MCP сервера для Wildberries API

## Статус: ✅ ЗАВЕРШЕНО

### Выполнено:
- ✅ Инициализация проекта (package.json, tsconfig.json, структура директорий)
- ✅ Конфигурация и переменные окружения (env.ts, config.ts)
- ✅ Wildberries Client (HTTP клиент, авторизация, rate limiter, error handler)
- ✅ Утилиты (logger, validator, formatter)
- ✅ TypeScript типы (api.ts, tools.ts, common.ts)
- ✅ Инструменты для товаров (4 инструмента)
- ✅ Инструменты для заказов FBS (3 инструмента)
- ✅ Инструменты для аналитики (3 инструмента)
- ✅ MCP Server Core (stdio transport, регистрация инструментов)
- ✅ Документация (README, API reference, examples, ARCHITECTURE)
- ✅ Обновлён development-history.md
- ✅ Созданы ADR для архитектурных решений

## Важные решения

1. **TypeScript + ES Modules**: Выбран для типобезопасности и современности
2. **Zod для валидации**: Декларативные схемы с автоматическим выводом типов
3. **Модульная структура**: Инструменты разделены по разделам API
4. **Rate Limiter**: Скользящее окно, 100 req/min, автоматическое ожидание
5. **Retry логика**: Экспоненциальный backoff для временных ошибок

## Следующий шаг

### Приоритет 1: Тестирование с реальным API
- Создать API токен в личном кабинете Wildberries
- Добавить токен в `.env` файл
- Протестировать все 10 инструментов MVP
- Проверить обработку ошибок и edge cases
- Обновить endpoints в коде если потребуется

### Приоритет 2: Unit тесты
- Настроить test framework (Jest или Vitest)
- Покрыть тестами основные компоненты:
  - Rate limiter
  - Error handler
  - Validators
  - Tool handlers (с моками API)

### Приоритет 3: Расширение функциональности
- Добавить инструменты для заказов DBW/DBS/Самовывоз
- Реализовать инструменты для маркетинга
- Добавить инструменты для отчётов

## Файлы в работе

### Основные файлы проекта:
- `package.json` - зависимости и скрипты
- `tsconfig.json` - конфигурация TypeScript
- `src/index.ts` - точка входа MCP сервера
- `.env.example` - шаблон конфигурации
- `.env` - переменные окружения (скрыт от AI через .cursorignore)

### Документация:
- `README.md` - основная документация
- `docs/api-reference.md` - справочник инструментов
- `docs/examples.md` - примеры использования
- `ARCHITECTURE.md` - архитектура проекта
- `ADR.md` - архитектурные решения
- `development-history.md` - история разработки
- `AGENTS.md` - правила работы над проектом

### Реализованные модули:
- `src/config/` - конфигурация и env
- `src/client/` - HTTP клиент, auth, rate limiter, error handler
- `src/utils/` - logger, validator, formatter
- `src/types/` - TypeScript типы
- `src/tools/` - 10 инструментов MVP

### Архив:
- `archive/` - старые файлы спецификации и планирования

## Технические детали

### Структура инструментов (10 MVP):

**Товары (4):**
1. wb_get_products
2. wb_update_product_content
3. wb_update_product_price
4. wb_update_product_stock

**Заказы FBS (3):**
5. wb_get_orders_fbs
6. wb_get_picking_tasks_fbs
7. wb_update_order_status_fbs

**Аналитика (3):**
8. wb_get_search_queries
9. wb_get_stock_history
10. wb_get_sales_funnel

### API Endpoints:
- Content API: content-api.wildberries.ru
- Marketplace API: marketplace-api.wildberries.ru
- Statistics API: statistics-api.wildberries.ru
- Suppliers API: suppliers-api.wildberries.ru

### Настройки:
- Rate Limit: 100 req/min, скользящее окно
- Retry: 3 попытки, экспоненциальный backoff (1s, 2s, 4s)
- Timeout: 30s (обычные), 120s (загрузка)
- Логирование: Winston, файлы в logs/

## Известные ограничения

1. **Endpoints не проверены**: Используются предполагаемые URLs из документации, требуется валидация с реальным API
2. **Нет тестов**: Требуется покрытие unit и integration тестами
3. **Только MVP разделы**: Реализованы только товары, заказы FBS и базовая аналитика

## Команды для работы

```bash
# Установка зависимостей
npm install

# Сборка
npm run build

# Запуск
npm start

# Разработка (watch mode)
npm run dev
```

## Перед следующей сессией

1. Прочитать `.CLAUDE-context.md` (этот файл)
2. Проверить последнюю запись в `development-history.md`
3. Ознакомиться с TODO в `ARCHITECTURE.md` roadmap
